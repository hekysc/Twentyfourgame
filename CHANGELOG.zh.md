# 更新日志（功能实现历史）

## 2025-09-17
統計頁「玩家總覽」排序（完整列）
- 表頭點擊統一觸發排序，支援列：用戶、總局數、成功數、勝率、平均、最佳。
- 預設按「勝率」降序展示；再次點擊同一列可切換升/降序。
- 排序方向持久化到本地 `tf24_overview_sort_v1`，跨頁面/重啟仍保持。
- 追加每列表頭的點擊綁定（提升點擊命中精度）；同時保留表頭容器級代理作為兜底。
- 修復統計頁中文亂碼（H5 運行時補丁），包括：頁面標題、範圍切換按鈕、表頭欄位、趨勢圖圖例；修正運算符清單為「+ - × ÷」。

统计页计算逻辑拆分
- 新增 `utils/stats.js`，将近似24误差、每日序列、小火花、牌面热度、牌面签名Top5、概览聚合等计算迁移为纯函数；
- `pages/stats/index.vue` 引入并替换部分 computed 使用，保持功能与显示一致。

同一手牌重复统计失败次数
- 同一手四张牌，如果重复计算出错，只计算一次失败。也就是说，同一手四张牌，提交后只计算一次成绩，以第一次提交时为准。

优化表达式有效性规则
- 规则：数字后不能是左括号，右括号后不能是数字
- 两个数字不能直接相邻

## 2025-09-16
自定义 TabBar：同页点击短路
- 点击当前已激活的 Tab 不进行任何处理，不触发导航，不刷新当前页面。
- 比较当前路由与目标路由时做标准化处理，避免斜杠、查询串导致的误判。
- 调整导航降级顺序：优先 `switchTab` → `navigateTo` → `reLaunch`。

跨页导航无响应修复
- 修复在部分端点击非当前页面 Tab 无反应、停留在当前页的问题。
- 采用导航 API 的 `success/fail` 回调进行可靠降级：`switchTab` → `navigateTo` → `reLaunch`，确保始终能跳转。
- 跳转成功后同步更新选中态。

统计页「玩家总览」排序（完整列）
- 默认按“胜率”降序展示，支持排序方向记忆（本地：`tf24_overview_sort_v1`）。
- 可按列排序：用户（name，先升后降）、总局数（times，先降后升）、成功数（success，先降后升）、🎯胜率（winRate，先降后升）、平均（avgTimeMs，先升后降）、🏆最佳（bestTimeMs，先升后降）。
- 表头存在历史编码问题的列，暂通过表头上方“排序栏”提供等价操作；后续将清理表头结构，统一从表头点击触发。

## 2025-09-14
TabBar 选中态修复与样式统一
- 修复“统计/程序/用户”三项选中判断与绑定，图标与文字均高亮放大，未选中置灰。
- 修复“用户”项 active 误用 index 的问题。
- 统一标签文字颜色：未选中 `#94a3b8`，选中 `#0953e9`。
- 移除每个按钮的默认边框/轮廓及伪元素描边，兼容 H5/小程序/App。

## 2025-09-13
统计页与 UI 优化（概要）
- 时间窗口：今天/3/7/30/全部；以本地 00:00 作为起点统一口径。
- 指标与概览：错误近似 TOP、首运算符成功率、运算熵、牌型签名命中率、速度-准确分桶、连胜/连败与滚动指标、技能雷达等。
- UI 与交互：自定义 TabBar、首页背景适配、进入统计自动刷新、去除“清空表达式”按钮、无用户拦截跳转登录等。
