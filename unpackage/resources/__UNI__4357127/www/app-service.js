if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((n=>t.resolve(e()).then((()=>n))),(n=>t.resolve(e()).then((()=>{throw n}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";class t{constructor(e,t){if(0===t)throw new Error("denominator 0");this.n=e,this.d=t,this.normSelf()}static fromInt(e){return new t(e,1)}normSelf(){let e=this.n,t=this.d;t<0&&(e=-e,t=-t);const n=function(e,t){for(e=Math.abs(e),t=Math.abs(t);0!==t;){const n=e%t;e=t,t=n}return 0===e?1:Math.abs(e)}(Math.abs(e),Math.abs(t));this.n=e/n,this.d=t/n}plus(e){return new t(this.n*e.d+e.n*this.d,this.d*e.d)}minus(e){return new t(this.n*e.d-e.n*this.d,this.d*e.d)}times(e){return new t(this.n*e.n,this.d*e.d)}div(e){if(0===e.n)throw new Error("divide by zero");return new t(this.n*e.d,this.d*e.n)}equalsInt(e){return this.n===e*this.d}toString(){return 1===this.d?String(this.n):`${this.n}/${this.d}`}}function n(e){if(!e||4!==e.length)throw new Error("need 4 numbers");const n=o(e.map((e=>({v:t.fromInt(e),expr:String(e)}))));return n?n.expr:null}function o(e){if(1===e.length)return e[0].v.equalsInt(24)?e[0]:null;for(let t=0;t<e.length;t++)for(let n=0;n<e.length;n++){if(t===n)continue;const l=[];for(let o=0;o<e.length;o++)o!==t&&o!==n&&l.push(e[o]);const r=e[t],a=e[n];{const e={v:r.v.plus(a.v),expr:`(${r.expr}+${a.expr})`},t=o(l.concat([e]));if(t)return t}{const e={v:r.v.minus(a.v),expr:`(${r.expr}-${a.expr})`},t=o(l.concat([e]));if(t)return t}{const e={v:r.v.times(a.v),expr:`(${r.expr}×${a.expr})`},t=o(l.concat([e]));if(t)return t}if(0!==a.v.n){const e={v:r.v.div(a.v),expr:`(${r.expr}÷${a.expr})`},t=o(l.concat([e]));if(t)return t}}return null}function l(e){const n=[];let o=0;for(;o<e.length;){const t=e[o];if(/\s/.test(t))o++;else if("()+-×÷".includes(t))n.push({t:t}),o++;else{if(!/\d/.test(t))return null;{let t=o+1;for(;t<e.length&&/\d/.test(e[t]);)t++;n.push({t:e.slice(o,t)}),o=t}}}const l=e=>"+"===e||"-"===e?1:"×"===e||"÷"===e?2:0,r=[],a=[];for(const t of n)if(/^\d/.test(t.t))r.push(t);else if("("===t.t)a.push(t);else if(")"===t.t){for(;a.length&&"("!==a[a.length-1].t;)r.push(a.pop());if(!a.length||"("!==a[a.length-1].t)return null;a.pop()}else{if(!"+-×÷".includes(t.t))return null;for(;a.length;){const e=a[a.length-1].t;if(!("+-×÷".includes(e)&&l(e)>=l(t.t)))break;r.push(a.pop())}a.push(t)}for(;a.length;){const e=a.pop();if("("===e.t)return null;r.push(e)}const u=[];for(const i of r)if(/^\d/.test(i.t))u.push(t.fromInt(parseInt(i.t)));else{if(u.length<2)return null;const e=u.pop(),t=u.pop();let n;if("+"===i.t)n=t.plus(e);else if("-"===i.t)n=t.minus(e);else if("×"===i.t)n=t.times(e);else{if("÷"!==i.t)return null;if(0===e.n)return null;n=t.div(e)}u.push(n)}return 1===u.length?u[0]:null}__definePage("pages/index/index",((e,t)=>{const n=e.__vccOpts||e;for(const[o,l]of t)n[o]=l;return n})({__name:"index",setup(t){const o=e.ref([1,5,5,5]),r=e.ref(null),a=e.ref(""),u=e.ref([0,0,0,0]),i=e.ref([]),s=["+","-","×","÷","(",")"],c=e.ref({active:!1,token:null,x:0,y:0,startX:0,startY:0,moved:!1}),v=e.ref({left:0,top:0,right:0,bottom:0}),p=e.ref([]),f=e.ref(-1),d=e.ref(-1),{proxy:h}=e.getCurrentInstance(),m=e.computed((()=>i.value.map((e=>e.value)).join(""))),y=e.computed((()=>`left:${c.value.x}px; top:${c.value.y}px;`)),x=e.computed((()=>{const e=c.value.token;return c.value.active&&e?"num"===e.type?"num":"op"===e.type?"op":"tok"===e.type?(t=e.value,/^(10|11|12|13|[1-9])$/.test(t)?"num":"op"):"op":"op";var t})),g=e.computed((()=>{const e=m.value;if(!e)return"";const t=l(e);return t?`${t.toString()}`:""}));function k(){const{nums:e,sol:t}=function(){for(;;){const e=Array.from({length:4},(()=>1+Math.floor(13*Math.random()))),t=n(e);if(t)return{nums:e,sol:t}}}();o.value=e,r.value=t,i.value=[],a.value="出题完成：请用四张牌 + - × ÷ ( ) 算出 24",u.value=[0,0,0,0]}function w(){i.value=[],u.value=[0,0,0,0]}function E(){const e=m.value,t=function(e,t){if(!e)return!1;const n=/(10|11|12|13|[1-9])/g,o=[];let l;for(;null!==(l=n.exec(e));)o.push(parseInt(l[0]));const r=new Map;for(const u of t)r.set(u,(r.get(u)||0)+1);const a=new Map;for(const u of o)a.set(u,(a.get(u)||0)+1);for(const[u,i]of a){const e=r.get(u)||0;if(i>e)return!1;r.set(u,e-i)}for(const u of r.values())if(0!==u)return!1;return!0}(e,o.value);if(!t)return void(a.value="表达式未正确使用四张牌（每张各一次）或包含不允许的内容");const n=l(e);a.value=n&&n.equalsInt&&n.equalsInt(24)?"正确！恭喜你算出 24":"结果不是 24，请再试试～"}function B(){a.value=r.value?"提示："+r.value:"暂无提示"}function V(e,t){c.value.active=!0,c.value.token=e;const n=N(t);c.value.x=n.x,c.value.y=n.y,c.value.startX=n.x,c.value.startY=n.y,c.value.moved=!1,M()}function b(e){if(!c.value.active)return;const t=N(e);c.value.x=t.x,c.value.y=t.y;const n=c.value.x-c.value.startX,o=c.value.y-c.value.startY;!c.value.moved&&n*n+o*o>16&&(c.value.moved=!0);const l=c.value.token;if(l&&"tok"===l.type){const e=c.value.x,t=c.value.y;if(I(v.value,e,t)){const n=C(e,t);n!==l.index&&n!==l.index+1&&(T(l.index,n),l.index=n>l.index?n-1:n,M()),f.value=n}else f.value=-1}else{const e=c.value.x,t=c.value.y,n=I(v.value,e,t);f.value=n?C(e,t):-1}}function A(){if(!c.value.active)return;const e=c.value.x,t=c.value.y,n=c.value.token,o=I(v.value,e,t);if(n&&"tok"===n.type)if(c.value.moved)if(o){const o=C(e,t);T(n.index,o),d.value=Math.max(0,Math.min(o,i.value.length-1)),setTimeout((()=>{d.value=-1}),220)}else!function(e){if(e<0||e>=i.value.length)return;const t=i.value[e];if(t&&"num"===t.type&&null!=t.cardIndex){const e=u.value.slice();e[t.cardIndex]=0,u.value=e}i.value=i.value.slice(0,e).concat(i.value.slice(e+1))}(n.index);else;else if(o&&n){const o=C(e,t);!function(e,t){const n=Math.max(0,Math.min(t,i.value.length));if("num"===e.type){const t=e.cardIndex;if(null==t)return void(a.value="该卡片信息缺失");if((u.value[t]||0)>=1)return void(a.value="该卡片已用过");const o=i.value.slice();o.splice(n,0,{type:"num",value:e.value,cardIndex:t}),i.value=o;const l=u.value.slice();l[t]=1,u.value=l}else if("op"===e.type){const t=i.value.slice();t.splice(n,0,{type:"op",value:e.value}),i.value=t}}(n,o),d.value=Math.max(0,Math.min(o,i.value.length-1)),setTimeout((()=>{d.value=-1}),220)}c.value.active=!1,c.value.token=null,f.value=-1}function M(){uni.createSelectorQuery().in(h).select("#exprZone").boundingClientRect().selectAll(".tok").boundingClientRect().exec((e=>{const[t,n]=e||[];t&&(v.value={left:t.left,top:t.top,right:t.right,bottom:t.bottom}),p.value=n||[]}))}function I(e,t,n){return t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom}function N(e){const t=e.touches&&e.touches[0]||e.changedTouches&&e.changedTouches[0]||e.detail||{x:0,y:0};return{x:t.clientX??t.x??0,y:t.clientY??t.y??0}}function C(e,t){const n=p.value||[];if(!n.length)return i.value.length;let o=0,l=1/0;for(let a=0;a<n.length;a++){const r=n[a],u=r.left+r.width/2-e,i=r.top+r.height/2-t,s=u*u+i*i;s<l&&(l=s,o=a)}const r=n[o];return e<r.left+r.width/2?o:o+1}function T(e,t){if(e===t)return;const n=i.value.slice(),o=n.splice(e,1)[0],l=Math.max(0,Math.min(t,n.length));n.splice(l,0,o),i.value=n}return e.onMounted((()=>{k()})),(t,n)=>{var l;return e.openBlock(),e.createElementBlock("view",{class:"page col",style:{padding:"24rpx",gap:"24rpx",position:"relative"}},[e.createElementVNode("text",{style:{"font-size":"40rpx","font-weight":"700","text-align":"center"}},"24 点小游戏"),e.createElementVNode("view",{class:"col",style:{gap:"12rpx"}},[e.createElementVNode("text",{style:{"font-size":"28rpx","font-weight":"600"}},"将四张牌拖到表达式区域（每张最多用一次）"),e.createElementVNode("view",{class:"cards-row"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:e.normalizeClass(["card-num",{used:(u.value[o]||0)>0}]),onTouchstart:e.withModifiers((e=>V({type:"num",value:String(t),cardIndex:o},e)),["stop","prevent"]),onTouchmove:n[0]||(n[0]=e.withModifiers((e=>b(e)),["stop","prevent"])),onTouchend:n[1]||(n[1]=e.withModifiers((e=>A()),["stop","prevent"]))},[e.createElementVNode("text",{class:"card-num-text"},e.toDisplayString(t),1),(u.value[o]||0)>0?(e.openBlock(),e.createElementBlock("text",{key:0,class:"card-num-used"},"已用 "+e.toDisplayString(u.value[o]),1)):e.createCommentVNode("",!0)],42,["onTouchstart"])))),128))])]),e.createElementVNode("view",{class:"col",style:{gap:"12rpx"}},[e.createElementVNode("text",{style:{"font-size":"28rpx","font-weight":"600"}},"拖拽运算符"),e.createElementVNode("view",{class:"ops-row"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(s,(t=>e.createElementVNode("view",{key:t,class:"op-chip",onTouchstart:e.withModifiers((e=>V({type:"op",value:t},e)),["stop","prevent"]),onTouchmove:n[2]||(n[2]=e.withModifiers((e=>b(e)),["stop","prevent"])),onTouchend:n[3]||(n[3]=e.withModifiers((e=>A()),["stop","prevent"]))},e.toDisplayString(t),41,["onTouchstart"]))),64))])]),e.createElementVNode("view",{id:"exprZone",class:e.normalizeClass(["expr-zone",{"expr-zone-active":c.value.active}])},[0===i.value.length?(e.openBlock(),e.createElementBlock("text",{key:0,style:{color:"#999"}},"将卡牌和运算符拖到这里组成表达式")):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"row expr-row"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.value,((t,o)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:o},[f.value===o?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["insert-placeholder",x.value])},null,2)):e.createCommentVNode("",!0),e.createElementVNode("view",{class:e.normalizeClass(["tok",["num"===t.type?"num":"op",{"just-inserted":o===d.value,dragging:c.value.token&&"tok"===c.value.token.type&&c.value.token.index===o}]]),onTouchstart:e.withModifiers((e=>V({type:"tok",index:o,value:t.value},e)),["stop","prevent"]),onTouchmove:n[4]||(n[4]=e.withModifiers((e=>b(e)),["stop","prevent"])),onTouchend:n[5]||(n[5]=e.withModifiers((e=>A()),["stop","prevent"]))},e.toDisplayString(t.value),43,["onTouchstart"])],64)))),128)),f.value===i.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:e.normalizeClass(["insert-placeholder",x.value])},null,2)):e.createCommentVNode("",!0)]),e.createElementVNode("view",{style:{"margin-top":"12rpx",color:"#666","font-size":"26rpx"}},[e.createElementVNode("text",null,"当前："),g.value?(e.openBlock(),e.createElementBlock("text",{key:0},e.toDisplayString(g.value),1)):(e.openBlock(),e.createElementBlock("text",{key:1},"未完成"))])],2),e.createElementVNode("view",{class:"actions-row"},[e.createElementVNode("button",{class:"btn",onClick:E},"判定是否=24"),e.createElementVNode("button",{class:"btn outlined",onClick:k},"换一题（必有解）"),e.createElementVNode("button",{class:"btn outlined",onClick:B},"查看提示/答案"),e.createElementVNode("button",{class:"btn outlined",onClick:w},"清空")]),e.createElementVNode("text",{style:{"font-size":"28rpx",color:"#333"}},e.toDisplayString(a.value),1),c.value.active?(e.openBlock(),e.createElementBlock("view",{key:0,class:"drag-ghost",style:e.normalizeStyle(y.value)},e.toDisplayString(null==(l=c.value.token)?void 0:l.value),5)):e.createCommentVNode("",!0)])}}},[["__scopeId","data-v-a1056af1"]]));const r={onLaunch(){},onShow(){},onHide(){}};const{app:a,Vuex:u,Pinia:i}={app:e.createVueApp(r)};uni.Vuex=u,uni.Pinia=i,a.provide("__globalStyles",__uniConfig.styles),a._component.mpType="app",a._component.render=()=>{},a.mount("#app")}(Vue);
