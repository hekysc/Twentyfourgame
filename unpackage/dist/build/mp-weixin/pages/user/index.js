"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/store.js"),a=require("../../utils/hints.js"),r=require("../../utils/edge-exit.js"),i=require("../../utils/avatar.js"),n=require("../../utils/navigation.js"),c=require("../../utils/useSafeArea.js"),o=require("../../utils/tab-cache.js");Math||u();const u=()=>"../../components/CustomTabBar.js",s={__name:"index",setup(u){const s=e.ref({list:[],currentId:""}),d=e.ref(""),{hintState:l,showHint:h,hideHint:f}=a.useFloatingHint(),v=r.useEdgeExit({showHint:h,onExit:()=>{n.exitApp({fallback:()=>{try{if("function"==typeof e.index.switchTab)return void e.index.switchTab({url:"/pages/index/index"})}catch(t){}try{if("function"==typeof e.index.reLaunch)return void e.index.reLaunch({url:"/pages/index/index"})}catch(t){}}})}}),{safeTop:p,safeBottom:x}=c.useSafeArea(),m=c.rpxToPx(24)||12,g=c.rpxToPx(120)||60,T=e.ref(o.getTabBarHeight()||g),b=e.computed((()=>{const e=Math.max(0,p.value||0),t=Math.max(0,x.value||0),a=T.value||g;return{paddingTop:`${e+m}px`,paddingLeft:`${m}px`,paddingRight:`${m}px`,paddingBottom:`${m+t+a}px`,display:"flex",flexDirection:"column",rowGap:"16rpx",backgroundColor:"#f8fafc",boxSizing:"border-box",minHeight:"calc(var(--vh, 1vh) * 100)"}}));function y(){const e=o.getCachedUsersState();if(e&&Array.isArray(e.list))return void(s.value=e);const a=t.getUsers();s.value=a,o.setCachedUsersState(a)}const U=e.computed((()=>(s.value.list||[]).filter((e=>"Guest"!==String(e.name||"")))));function S(){t.addUser(d.value.trim()||void 0),d.value="",y();try{o.scheduleTabWarmup({delay:200})}catch(e){}}function j(e){if(!e)return"U";const t=String(e).trim();return t.length?t[0].toUpperCase():"U"}return e.onMounted((()=>{try{e.index.hideTabBar&&e.index.hideTabBar()}catch(a){}t.ensureInit(),T.value=o.getTabBarHeight()||T.value,y()})),e.onShow((()=>{T.value=o.getTabBarHeight()||T.value,y();try{e.index.$emit&&e.index.$emit("tabbar:update")}catch(t){}i.consumeAvatarRestoreNotice()&&h("头像文件丢失，已为你恢复为默认头像",2e3)})),(a,r)=>e.e({a:d.value,b:e.o((e=>d.value=e.detail.value)),c:e.o(S),d:e.f(U.value,((a,r,n)=>e.e({a:a.avatar},a.avatar?{b:a.avatar}:{c:e.t(j(a.name)),d:a.color||"#e2e8f0"},{e:e.t(a.name),f:e.o((r=>function(a){t.switchUser(a),y();try{o.scheduleTabWarmup({delay:200})}catch(r){}try{e.index.reLaunch({url:"/pages/index/index"})}catch(r){try{e.index.navigateTo({url:"/pages/index/index"})}catch(i){}}}(a.id)),a.id),g:e.o((r=>function(a){e.index.showModal({title:"改名",editable:!0,placeholderText:a.name,success(e){if(e.confirm){t.renameUser(a.id,e.content||a.name),y();try{o.scheduleTabWarmup({delay:200})}catch(r){}}}})}(a)),a.id),h:e.o((t=>function(t){if(t&&t.id)try{e.index.showActionSheet({itemList:["从相册选择","移除头像","取消"],success(a){const r=a.tapIndex;if(0===r)try{e.index.chooseImage({count:1,sizeType:["compressed"],success(e){const a=e.tempFilePaths&&e.tempFilePaths[0]||"",r=e.tempFiles&&e.tempFiles[0]&&e.tempFiles[0].size||0;a?i.saveAvatarForUser(t.id,a,{size:r}).then((e=>{e&&e.ok?h("头像已更新",1200):h("头像保存失败，请重试",1800),y();try{o.scheduleTabWarmup({delay:240})}catch(t){}})):h("未选择有效头像",1500)},fail(){h("头像选择已取消",1200)}})}catch(n){}else 1===r&&i.removeAvatarForUser(t.id).then((()=>{h("已恢复默认头像",1500),y();try{o.scheduleTabWarmup({delay:240})}catch(n){}})).catch((()=>{h("头像清除失败，请重试",1800)}))}})}catch(a){}}(a)),a.id),i:e.o((r=>{return n=a.id,void e.index.showModal({title:"删除用户",content:"确定删除该用户？",success(e){e.confirm&&i.removeAvatarForUser(n).finally((()=>{t.removeUser(n),y();try{o.scheduleTabWarmup({delay:200})}catch(e){}}))}});var n}),a.id),j:a.id,k:a.id===s.value.currentId?1:""}))),e:e.unref(l).visible},e.unref(l).visible?{f:e.t(e.unref(l).text),g:e.o((()=>{})),h:e.unref(l).interactive?1:"",i:e.o(((...t)=>e.unref(f)&&e.unref(f)(...t)))}:{},{j:e.s(b.value),k:e.o(((...t)=>e.unref(v).handleTouchStart&&e.unref(v).handleTouchStart(...t))),l:e.o(((...t)=>e.unref(v).handleTouchMove&&e.unref(v).handleTouchMove(...t))),m:e.o(((...t)=>e.unref(v).handleTouchEnd&&e.unref(v).handleTouchEnd(...t))),n:e.o(((...t)=>e.unref(v).handleTouchCancel&&e.unref(v).handleTouchCancel(...t)))})}},d=e._export_sfc(s,[["__scopeId","data-v-e183a182"]]);wx.createPage(d);
