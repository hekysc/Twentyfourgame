"use strict";const t=require("../../common/vendor.js"),e=require("../../utils/store.js"),n={__name:"index",setup(n){const o=t.ref({list:[],currentId:""}),r=t.ref("");function i(){try{const e=(t.index.getSystemInfoSync&&t.index.getSystemInfoSync()||{}).windowHeight||("undefined"!=typeof window?window.innerHeight:0)||0;e&&"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.setProperty("--vh",.01*e+"px")}catch(e){}}function a(){try{const t=e.getUsers();if(!t||!Array.isArray(t.list)||void 0===t.currentId)throw new Error("本地用户数据结构无效");o.value=t}catch(t){r.value=t&&t.message?t.message:"本地存储损坏"}}t.onMounted((()=>{e.ensureInit(),a();try{i()}catch(n){}t.index.onWindowResize&&t.index.onWindowResize((()=>{try{i()}catch(n){}}))}));const c=t.computed((()=>{const t=(o.value.list||[]).filter((t=>"Guest"!==String(t.name||""))).slice();return t.sort(((t,e)=>(e.lastPlayedAt||0)-(t.lastPlayedAt||0)||(e.createdAt||0)-(t.createdAt||0))),t}));function s(e){try{t.index.reLaunch({url:e})}catch(n){try{t.index.navigateTo({url:e})}catch(o){try{t.index.switchTab({url:e})}catch(r){}}}}function d(){t.index.showModal({title:"新建玩家",editable:!0,placeholderText:"昵称（1-20字）",success(e){if(!e.confirm)return;const n=String(e.content||"").trim();if(!n||n.length<1||n.length>20)return void t.index.showToast({title:"请输入1-20字昵称",icon:"none"});(o.value.list||[]).some((t=>String(t.name||"").toLowerCase()===n.toLowerCase()))?t.index.showModal({title:"提示",content:"已有同名玩家，是否继续创建？",success(t){t.confirm?u(n):d()}}):u(n)}})}function u(e){t.index.showActionSheet({itemList:["请选择头像方式","从相册选择","随机分配","跳过"],success(n){const o=n.tapIndex;1===o?t.index.chooseImage({count:1,sizeType:["compressed"],success(t){const n=t.tempFilePaths&&t.tempFilePaths[0]||"";l(e,n)},fail(){l(e,"")}}):(2===o||3===o)&&l(e,"")},fail(){l(e,"")}})}function l(t,n){const o=e.addUser(t,n);e.switchUser(o),e.touchLastPlayed(o),s("/pages/login/index")}function f(t){if(!t)return"U";const e=String(t).trim();return e.length?e[0].toUpperCase():"U"}function g(t){if(!t)return"从未游玩";try{const e=new Date(t),n=Date.now(),o=new Date,r=e.toDateString()===o.toDateString(),i=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0"),c=e.getDate().toString().padStart(2,"0"),s=e.getHours().toString().padStart(2,"0"),d=e.getMinutes().toString().padStart(2,"0");if(r)return`今天 ${s}:${d}`;const u=new Date(n-864e5);return e.toDateString()===u.toDateString()?`昨天 ${s}:${d}`:`${i}-${a}-${c} ${s}:${d}`}catch(e){return"时间未知"}}function h(t){const e=String(t.id||t.name||"");let n=0;for(let r=0;r<e.length;r++)n=33*n+e.charCodeAt(r)>>>0;const o=["#e2e8f0","#fde68a","#bbf7d0","#bfdbfe","#fecaca","#f5d0fe","#c7d2fe"];return o[n%o.length]}function m(){t.index.showModal({title:"重置数据",content:"将清空本地所有数据，是否继续？",success(t){t.confirm&&(e.resetAllData(),r.value="",a())}})}return(n,o)=>t.e({a:r.value},r.value?{b:t.t(r.value),c:t.o(m)}:0===c.value.length?{e:t.o(d)}:{f:t.f(c.value,((n,o,r)=>t.e({a:n.avatar},n.avatar?{b:n.avatar}:{c:t.t(f(n.name)),d:n.color||h(n)},{e:t.t(n.name),f:t.t(g(n.lastPlayedAt)),g:n.id,h:t.o((t=>function(t){e.switchUser(t.id),e.touchLastPlayed(t.id),s("/pages/index/index")}(n)),n.id)}))),g:t.o(d)},{d:0===c.value.length})}},o=t._export_sfc(n,[["__scopeId","data-v-721cfcc0"]]);wx.createPage(o);
