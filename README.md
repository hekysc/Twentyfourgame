# 24 点（Uni-App + Vue 3）

一个 24 点小程序，支持拖拽编辑表达式、判定结果、用户与统计数据管理。推荐使用 HBuilderX 运行与打包。

## 功能特性 

- 表达式编辑：拖拽卡牌与运算符，单击插入/删除；按下并移动即为拖拽 
- 运算精度：使用分数运算，避免浮点误差；运算符统一为 `×`、`÷` 
- 本局计时与洗牌：程序页统计表新增“本局”计时（0.1s 精度），超过 2 分钟自动显示“洗牌”按钮，点击后重新洗牌且不计为失败 
- 发牌与出题：整副用尽或无可解手牌时可“重洗”，开始新一副牌；本副内统计清零 
- 成功反馈：答对后显示 0.5s 成功动画，随后自动下一题 
- 会话持久化：离开页面再返回不丢当前手牌、表达式与提示状态 
- 统计页：时间窗口（今天/3/7/30/全部），多维分析与迷你图形；切换进入自动刷新 
- 用户管理：新增/重命名/删除用户，头像设置，按用户统计与切换 
- 高级 UI 风格：统一卡片、按钮与配色，跨页面一致 

## 目录结构 

- `App.vue` / `main.js`：应用入口
- `pages/` 页面 
  - `pages/login/index.vue` 登录/选择玩家 
  - `pages/index/index.vue` 程序主界面（拖拽、校验、提示、换题） 
  - `pages/user/index.vue` 用户管理 
  - `pages/stats/index.vue` 统计总览 
- `components/` 组件 
  - `components/MiniBar.vue` 百分比小条形图 
  - `components/MicroSpark.vue` 微火柴趋势图 
  - `components/PlayingCard.vue` 扑克牌渲染组件（渲染内置扑克牌 UI）
- `utils/` 工具 
  - `utils/solver.js` 24 点求解与分数计算 
  - `utils/store.js` 本地存储封装（用户与统计） 
- `static/` 静态资源（背景/图标等常规资源；扑克牌 PNG 已移除）
- `pages.json` 路由与 TabBar 配置
- `manifest.json` 应用配置（打包信息）

## 运行与打包（HBuilderX）

1. 打开 HBuilderX：文件 -> 打开目录 -> 选择仓库根目录
2. 运行：运行 -> 选择“运行到浏览器（H5）”或“运行到手机模拟器”
3. 打包 App：完善 `manifest.json` 后使用 HBuilderX 进行打包
4. 微信小程序：如需导出 mp-weixin 版本，可参考《[微信小程序打包适配提示词](docs/mp-weixin-prompts.md)》完成自查与适配。

## 操作说明（程序页） 

- 组表达式：
  - 单击卡牌或运算符：插入到表达式末尾
  - 单击表达式中的 token：删除该 token
  - 拖拽：按下并移动调整顺序或插入位置
- 校验：点击“提交答案”，计算是否等于 24 
- 提示与换题：可查看答案或直接换题（计入统计） 
- 重洗规则：
  - 本局计时：统计表格“本局”实时显示当前用时（0.1s 精度）。
  - 超时洗牌：当本局用时超过 2 分钟时，该单元变为“洗牌”按钮；点击后重新洗牌，不计为失败，并清零本副内统计（局数/成功/失败）。
  - 牌库用尽/无解洗牌：当整副用尽或余牌无解时会提示“是否重洗”，确认后开始新一副牌，并清零本副内统计；也可进入统计页查看数据。 

## 注意事项

- 统一使用 UTF-8 编码；中文与 `×`、`÷` 文案请勿替换为 `*`、`/`
- 如修改运算符或语法，请同步 UI 与 `utils/solver.js` 的解析与计算
- 不要手工修改 `unpackage/`（构建产物）

## 样式与图形化约定（UI 二轮） 

- 全局样式
  - 入口：`uni.scss`（引入 `styles/common.css`）。
  - 通用类：`.card`（白底+边框+圆角+阴影）、`.section`（内边距）、`.title`、`.btn-primary`、`.btn-ghost`、`.grid-table`。

- 迷你图形组件（无三方库）
  - `components/MiniBar.vue`：单值百分比条，props：`pct`（0–100）。
  - `components/MicroSpark.vue`：微火柴趋势，props：`values=[{rate:0..1}]`、`height`。
  - 用法示例：统计页“首运算-胜率”“速度分桶成功率”加入 MiniBar；滚动 7/30 天旁展示 MicroSpark。

- 落地范围 
  - 统计页（`pages/stats/index.vue`）：两处数字补充为迷你图形，提升可读性并保持跨端一致。 
  - 页面风格：在 index/user/login 的主要卡片与按钮处应用 `.card`、`.title`、`.btn-*` 等通用类，统一视觉；程序页的牌面使用 `.playing-card`，信息区沿用 `.card`。 

## 统计算法说明（概览）

- 时间范围筛选（今天/3天/7天/30天/全部）
  - 口径：取“本地今天 00:00”为起点，近 N 天为从该起点往前推 (N-1) 天；“全部”为不过滤。
  - 实施：以 `ts` 毫秒时间戳与 cutoff 对比过滤回合。

- 玩家总览与个人趋势（日柱）
  - 总览表：按时间窗口计算每用户 total/success/winRate，成功回合的 best/avg timeMs。
  - 日柱：按天聚合出 `total` 和 `success`，柱高按 `total` 归一，颜色/高度体现成功占比。

- 差一点榜（错误近似度）
  - 对失败表达式 `expr` 做安全归一（×→*、÷→/、移除空白），白名单校验后计算数值；异常/无穷跳过。
  - 计算 `diff = value - 24` 与 `abs = |diff|`，按 `abs` 升序选取 TOP5，保留正负方向。

- 近似度分布摘要
  - 指标：错误样本 |24-值| 的中位数、P90、<1、<0.1 占比；正偏/负偏比例。
  - 计算：对失败表达式求值并统计分布；无样本时返回占位与 0%。

- 运算偏好与效率
  - 首运算符成功率：对 `ops[0]` 聚合 total/success，给出胜率。
  - 运算“熵”：统计四类运算符（+ - × ÷）总体出现频次的分布熵 `-Σ p log2 p`，再除以 log2(4) 归一为 0–100%。

- 运算序列偏好（bigram/trigram/首两步）
  - 从回合的 `ops` 序列生成有序相邻二元/三元序列，聚合 total/success 得频率与胜率；
  - 首两步以 `ops[0] → ops[1]` 展示 Top 列表（文本 Sankey 的简化版）。

- 牌型签名与难度热力
  - 牌型签名：将手牌点数升序排序后用逗号拼接，如 `1,3,8,8`；用于聚合个人在该签名上的表现。
  - 命中率榜：Top5 按样本数与胜率排序；热力（列表版）展示 Top/Bottom 各 5，默认样本门槛 2 局。

- 速度-准确概览（分桶）
  - 桶定义：<1s、1–2s、2–5s、5–10s、10–30s、≥30s；统计每桶的总数/成功/失败。

- 连胜/连败与滚动指标
  - 连胜/连败：按时间升序扫描当前窗口内回合，更新“当前/最长 连胜 与 连败”。
  - 滚动指标：对最近 7/30 天的日聚合片段，计算滚动胜率与成功回合的滚动平均用时。

- 技能雷达（表格版）
  - 维度：＋、－、×、÷、括号、分数。
  - 判定：运算符来自 `ops`；括号来自表达式含 `()`；分数判断为 expr 含 `÷` 或 `.`，或求值为非整数。
  - 指标：各维度“使用占比”（占总回合）与“胜率”（使用该维度的回合内成功率）。

- 称号规则（基础版）
  - 多样探索者/单核惯性：运算熵 ≥75% / ≤35%。
  - 乘法信徒：× 在总体运算符中的占比 ≥40%。
  - 精准狙击：错误近似 |24-值| < 1 的占比 ≥50%。
  - 分数恐惧症：分数维度的胜率较总胜率低 ≥20 个百分点（且有使用）。
  - 逆转之王：成功中 `retries>0` 的占比 ≥50%，且成功样本数 ≥4。
  - 极速手：最佳成功用时 ≤ 1.5s。
  - 磨刀匠：平均重试次数 ≥1 且总体胜率 ≥50%。
